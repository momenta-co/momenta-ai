generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model experiences {
  id                String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  title             String
  description_short String?
  city              String
  price_min         Decimal?  @db.Decimal(10, 2)
  price_max         Decimal?  @db.Decimal(10, 2)
  duration_minutes  Int?
  tags              Json?     @default("[]")
  status            String?   @default("active")
  created_at        DateTime? @default(now()) @db.Timestamp(6)
  updated_at        DateTime? @default(now()) @db.Timestamp(6)
  image_url         String?
  numeric_id        Int       @unique(map: "idx_experiences_numeric_id") @default(autoincrement())
  slug              String?   @unique
  source_url        String?
  min_people        Int?      @default(1)

  @@index([city], map: "idx_experiences_city")
  @@index([status], map: "idx_experiences_status")
  @@index([slug], map: "idx_experiences_slug")
}

model recommendation_runs {
  id                  String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id             String          @db.Uuid
  input_context       Json?
  constraints_applied Json?
  candidate_ids       Json?           @default("[]")
  model               String?
  prompt_version      String?
  output              Json?
  created_at          DateTime?       @default(now()) @db.Timestamp(6)
  beta_feedback       beta_feedback[]

  @@index([created_at], map: "idx_recommendation_runs_created")
  @@index([user_id], map: "idx_recommendation_runs_user")
}

model beta_feedback {
  id                    String               @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  email                 String
  user_id               String?              @db.Uuid
  recommendation_run_id String?              @db.Uuid
  liked_recommendations Boolean?
  comments              String?
  created_at            DateTime?            @default(now()) @db.Timestamp(6)
  ip                    String?
  fullname              String?
  instagram_handle      String?
  chat_logs             Json?
  recommendation_runs   recommendation_runs? @relation(fields: [recommendation_run_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([created_at], map: "idx_beta_feedback_created")
  @@index([email], map: "idx_beta_feedback_email")
  @@index([recommendation_run_id], map: "idx_beta_feedback_run")
  @@index([user_id], map: "idx_beta_feedback_user")
}

model beta_signups {
  id               String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  email            String
  instagram_handle String?
  referral_source  String?
  metadata         Json?
  created_at       DateTime? @default(now()) @db.Timestamp(6)

  @@index([created_at], map: "idx_beta_signups_created")
  @@index([email], map: "idx_beta_signups_email")
}
